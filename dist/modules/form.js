/*!
 * =====================================================
 * iui v1.0.0 ()
 * =====================================================
 */

!function(i){"use strict";var e=".iui-form",t="iui-this",n="iui-disabled",s=function(){this.config={}};s.prototype.set=function(e){var t=this;return i.extend(!0,t.config,e),t},s.prototype.render=function(s,a){var u=this,c=i(e+(a?'[iui-filter="'+a+'"]':"")),o={select:function(){var e,s="iui-form-select",a="iui-select-title",u="iui-select-none",o="",l=function(t,n){i(t.target).parent().hasClass(a)&&!n||(i("."+s).removeClass(s+"ed "+s+"up"),e&&o&&e.val(o)),e=null},d=function(c,d,f){var h=i(this),v=c.find("."+a),p=v.find("input"),m=c.find("dl"),k=m.children("dd");if(!d){var g=function(){var i=c.offset().top+c.outerHeight()+5-r.scrollTop(),e=m.outerHeight();c.addClass(s+"ed"),k.removeClass("iui-hide"),i+e>r.height()&&i>=e&&c.addClass(s+"up")},b=function(i){c.removeClass(s+"ed "+s+"up"),p.blur(),i||x(p.val(),function(i){i&&(o=m.find("."+t).html(),p&&p.val(o))})};v.on("click",function(i){c.hasClass(s+"ed")?b():(l(i,!0),g()),m.find("."+u).remove()}),v.find(".iui-edge").on("click",function(){p.focus()}),p.on("keyup",function(i){9===i.keyCode&&g()}).on("keydown",function(i){var e=i.keyCode;9===e?b():13===e&&i.preventDefault()});var x=function(e,t,n){var s=0;k.each(function(){var t=i(this),a=t.text(),u=-1===a.indexOf(e);(""===e||"blur"===n?e!==a:u)&&s++,"keyup"===n&&t[u?"addClass":"removeClass"]("iui-hide")});var a=s===k.length;return t(a),a};f&&p.on("keyup",function(i){var e=this.value,t=i.keyCode;if(9===t||13===t||37===t||38===t||39===t||40===t)return!1;x(e,function(i){i?m.find("."+u)[0]||m.append('<p class="'+u+'">无匹配项</p>'):m.find("."+u).remove()},"keyup"),""===e&&m.find("."+u).remove()}).on("blur",function(i){e=p,o=m.find("."+t).html(),setTimeout(function(){x(p.val(),function(i){o||p.val("")},"blur")},200)}),k.on("click",function(){var e=i(this),s=e.attr("iui-value");h.attr("iui-filter");return!e.hasClass(n)&&(e.hasClass("iui-select-tips")?p.val(""):(p.val(e.text()),e.addClass(t)),e.siblings().removeClass(t),h.val(s).removeClass("iui-form-danger"),b(!0),!1)}),c.find("dl>dt").on("click",function(i){return!1}),i(document).off("click",l).on("click",l)}};c.find("select").each(function(e,u){var r=i(this),c=r.next("."+s),o=this.disabled,l=u.value,f=i(u.options[u.selectedIndex]),h=u.options[0];if("string"==typeof r.attr("iui-ignore"))return r.show();var v="string"==typeof r.attr("iui-search"),p=h?h.value?"请选择":h.innerHTML||"请选择":"请选择",m=i(['<div class="'+(v?"":"iui-unselect ")+s+(o?" iui-select-disabled":"")+'">','<div class="'+a+'"><input type="text" placeholder="'+p+'" value="'+(l?f.html():"")+'" '+(v?"":"readonly")+' class="iui-input'+(v?"":" iui-unselect")+(o?" "+n:"")+'">','<i class="iui-edge"></i></div>','<dl class="iui-anim iui-anim-upbit'+(r.find("optgroup")[0]?" iui-select-group":"")+'">'+function(i){for(var e=[],s=0;s<i.length;s++){var a=i[s];0!==s||a.value?"optgroup"===a.tagName.toLowerCase()?e.push("<dt>"+a.label+"</dt>"):e.push('<dd iui-value="'+a.value+'" class="'+(l===a.value?t:"")+(a.disabled?" "+n:"")+'">'+a.innerHTML+"</dd>"):e.push('<dd iui-value="" class="iui-select-tips">'+(a.innerHTML||"请选择")+"</dd>")}return 0===e.length&&e.push('<dd iui-value="" class="iui-disabled">没有选项</dd>'),e.join("")}(r.find("*"))+"</dl>","</div>"].join(""));c[0]&&c.remove(),r.after(m),d.call(this,m,o,v)})},checkbox:function(){var e={checkbox:["iui-form-checkbox","iui-form-checked","checkbox"],_switch:["iui-form-switch","iui-form-onswitch","switch"]},t=function(e,t){var n=i(this);e.on("click",function(){n.attr("iui-filter");var i=(n.attr("iui-text")||"").split("|");n[0].disabled||(n[0].checked?(n[0].checked=!1,e.removeClass(t[1]).find("em").text(i[1])):(n[0].checked=!0,e.addClass(t[1]).find("em").text(i[0])))})};c.find("input[type=checkbox]").each(function(s,a){var u=i(this),r=u.attr("iui-skin"),c=(u.attr("iui-text")||"").split("|"),o=this.disabled;"switch"===r&&(r="_"+r);var l=e[r]||e.checkbox;if("string"==typeof u.attr("iui-ignore"))return u.show();var d=u.next("."+l[0]),f=i(['<div class="iui-unselect '+l[0]+(a.checked?" "+l[1]:"")+(o?" iui-checkbox-disbaled "+n:"")+'" iui-skin="'+(r||"")+'">',{_switch:"<em>"+((a.checked?c[0]:c[1])||"")+"</em><i></i>"}[r]||(a.title.replace(/\s/g,"")?"<span>"+a.title+"</span>":"")+'<i class="iui-icon">'+(r?"&#xe605;":"&#xe618;")+"</i>","</div>"].join(""));d[0]&&d.remove(),u.after(f),t.call(this,f,l)})},radio:function(){var t="iui-form-radio",s=["&#xe643;","&#xe63f;"],a=function(n){var a=i(this),u="iui-anim-scaleSpring";n.on("click",function(){var r=a[0].name,c=a.parents(e),o=(a.attr("iui-filter"),c.find("input[name="+r.replace(/(\.|#|\[|\])/g,"\\$1")+"]"));a[0].disabled||(o.each(function(){var e=i(this).next("."+t);e.removeClass(t+"ed"),e.find(".iui-icon").removeClass(u).html(s[1])}),a[0].checked=!0,n.addClass(t+"ed"),n.find(".iui-icon").addClass(u).html(s[0]))})};c.find("input[type=radio]").each(function(e,u){var r=i(this),c=r.next("."+t),o=this.disabled;if("string"==typeof r.attr("iui-ignore"))return r.show();var l=i(['<div class="iui-unselect '+t+(u.checked?" "+t+"ed":"")+(o?" iui-radio-disbaled "+n:"")+'">','<i class="iui-anim iui-icon">'+s[u.checked?0:1]+"</i>","<span>"+(u.title||"未命名")+"</span>","</div>"].join(""));c[0]&&c.remove(),r.after(l),a.call(this,l)})}};return s?o[s]?o[s]():hint.error("不支持的"+s+"表单渲染"):iui.each(o,function(i,e){e()}),u};var a=new s,u=i(document),r=i(window);a.render(),u.on("reset",e,function(){var e=i(this).attr("iui-filter");setTimeout(function(){a.render(null,e)},50)})}(jQuery);